# Human Interface Devices

게임엔진이 어떻게 입력 기기로부터 데이터를 읽고 처리하는지 알아보자. 출력 기기에 어떻게 데이터 보내는지도 알아 보자

## HID의 종류

조이패드, 키보드, wii 리모트 컨트롤러, 스티어링 휠 등 매우 다양하다

## HID 인터페이스

### 폴링

게임 패드, 조이스틱 등으로부터의 입력은 주기적인 하드웨어 폴링으로 받는다. 즉, 게임 루프에서 매 프레임마다 현재 기기 상태를 읽어 오는 것.

마이크로소프트 XInput API가 좋은 예시인데, 매 프레임마다 게임은 `XInputGetState()` 함수를 호출해서 입력 상태를 폴링해온다. 

### 인터럽트

몇몇 HID는 컨트롤러 상태가 바뀔때만 게임 엔진에 데이터를 전송한다. 마우스같은게 대표적인데, 거의 항상 가만히 멈춰 있는데 계속 입력을 받고 있으면 비효율적이기 때문. 이런 종류의 입력 기기는 하드웨어 인터럽트를 이용해서 컴퓨터와 통신한다. 인터럽트는 하드웨어에서 발생되는 전기 신호인데, 이 신호는 CPU가 일시적으로 메인 프로그램의 실행을 중지하고 인터럽트 소스 런타임(ISR)이라고 불리는 작은 코드 조각을 실행하게 만든다. HID의 경우 ISR은 단순히 기기의 상태를 읽고 이후 처리를 위해 저장한 것 정도의 그친다.

### 무선 기기

듀얼 쇼크3 같은 블루투스 기기는 단순한 방식으로 입력을 받을 수 없다. 대신에, 입력 기기와 블루투스 프로토콜을 이용해서 통신해야한다. 소프트웨어에서 HID에 인풋 데이터를 보내줄 것을 요청하거나, 출력 데이터를 전송해주어야 한다. 이런 통신은 보통 게임 엔진의 메인 루프와 별도로 돌아가는 스레드에서 처리하거나, 최소한 메인 루프에서 호출할 수 있는 간단한 인터페이스로 캡슐화된다. 그래서 게임 프로그래머 입장에서는 다른 기기랑 무선 기기를 딱히 구분할 필요가 없다.

## 입력 종류

입력 기기는 아주 다양한 종류가 있지만 기기로부터 받은 입력의 종류는 한정된 몇 카테고리로 분류할 수 있다.

### 디지털 버튼

거의 모든 입력 기기가 디지털 버튼을 몇 개씩은 달고 있다. 이 버튼들은 누름 / 뗌 딱 두 가지 상태중 하나만 가진다. 소프트웨어에서 버튼의 상태는 보통 1비트로 표현된다. 0은 보통 뗌(up), 1은 누름(down)을 나타냄. 경우에 따라 반대일 수도 있다(구현하기 나름).

기기에 있는 모든 버튼의 상태를 부호 없는 정수형 변수 하나에 전부 다 담는게 일반적이다. 각각의 버튼 상태는 비트 연산으로 가져옴.

### 아날로그 축, 버튼

아날로그 입력은 특정 범위의 값 중 하나를 가질 수 있는 입력이다(보통 0~1사이의 실수). 이런 입력은 보통 조이스틱의 x,y축 혹은 버튼이 얼마나 눌렸는가 등을 표현하는데 쓰인다. 

정확히 말해서 아날로그 입력은 게임 엔진에서 쓰일 땐 아날로그가 아니다. 아날로그 입력은 보통 전자화(digitized)되는데, 이 말은 곧 입력이 양자화되어 정수로 저장된다는 뜻이다. 예를 들어, 아날로그 입력은 16비트 정수 -32768 ~ 32767 사이의 값으로 저장될 수 있다. 어떤 범위, 어떤 크기의 정수로 저장될 지도 제각각일 수 있음

### 상대 축(Relative Axes)

아날로그 버튼, 조이스틱 등등은 0의 위치가 명확하다(입력 값이 절대적이다). 반면에, 상대적인 입력을 받는 기기들도 있다. 이런 기기의 경우 값 0이 나타내는 위치가 명확하지 않다. 대신, 이 값은 이전 입력 값과 현재 입력 값의 차이를 나타내는데 쓰인다. 마우스 등이 대표적인 예시.

### 가속도계(Accelerometers)

몇몇 기기는 가속 센서를 가지고 있다. 컨트롤러 움직이면 움직이는 속도와 방향에 따라 입력을 받을 수 있음.

### 위모트, 듀얼 쇼크 등에서의 3D 방향

몇몇 기기는 플레이어가 들고 있는 조이패드가 3차원 상에서 어느 방향을 향하고 있는지를 입력 받을 수 있다. 

### 카메라

키넥트, IR 센서 등등

## 출력 종류

### 럼블(Rumble)

진동

### Force-Feedback

플레이어 입력에 저항. 스티어링 휠 같은 것

### 오디오

오디오는 보통 독립적인 엔진 시스템으로 동작한다. 몇몇 HID는 오디오 시스템에서 활용할만한 출력을 제공. 듀얼쇼크 같은 거에 달려있는 오디오 장치 등

### 기타 입출력

암튼 머 이상한 거 많음

## 게임 엔진 HID 시스템

게임 엔진에서는 당연히 HID 입력을 직접적으로 가져다 쓰지 않는다. HID 입력을 게임에서 가져다 쓰기 좋은 형태로 잘 가공해서 씀. 추가적으로 게임엔진들은 보통 HID 입력을 추상화해서 게임에서 HID 입력을 간접적으로 참조하게 해주는 레이어를 중간에 둔다(입력과 키 매핑 바꿀 수 있게)

### 일반적인 요구 사항

- 데드 존
- 아날로그 시그널 필터링
- 이벤트 감지
- 버튼 시퀀스 감지, 버튼 조합(chord) 등
- 제스쳐 감지
- 멀티 플레이어용 다중 HID 관리
- 멀티플랫폼 HID 서포트
- 컨트롤러 인풋 리매핑
- 컨텍스트 센서티브한 입력
- 일시적으로 몇몇 입력을 비활성화 할 수 있는 기능

### 데드 존

### 아날로그 시그널 필터링

### 입력 이벤트 감지

#### 버튼 업 다운

#### chords

#### 시퀀스, 제스쳐 감지

### 멀티 플레이어를 위한 다중 HID 관리

### 크로스 플랫폼 HID 시스템

### 인풋 리매핑

### 인풋 비활성화

## 실전 HID
