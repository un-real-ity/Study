# Tools for Debugging and Development

게임 개발은 매우 복잡하고 수학적이고 오류가 발생하기 쉬운 일이다. 그러니 게임 개발용, 디버깅용 도구를 잘 만드는 것이 중요함

## 로깅 / 추적(트레이싱)

디버거는 좋지만 디버거로 추적할 수 없는 버그들도 있다. 타이밍에 의존적이라 게임이 풀 스피드로 쌩쌩 돌아갈 때만 발생하는 이슈라거나, 아주 복잡한 이벤트들의 발생 순서와 연관되어 있어 라인 바이 라인으로 쫓아가기 힘들거나, 기타 등등

이럴 땐 로그 찍는 걸로 따라가는게 훨씬 좋다

- C/C++ 콘솔 프로그램이면 printf / fprintf / iostream 등
- Win32 프로그램이면 OutputDebugString(디버그 창에 찍어줌)

게임 엔진에서는 보통 이것보다 좀 더 좋은 로깅 수단을 제공해줌

### Formatted output with OutputDebugString

OutputDebugString이 formatted output을 지원하지 않아서 보통 래핑해서 쓴다. sprintf 계열을 쓰든 뭐 해서..

### Verbosity

vervosity 레벨에 따라 로그가 어디까지 보이게 할 지 지정해주는 기능을 만들어두면 유용하다. 가장 간단한 방법은 현재 verbosity 레벨을 전역 변수로 두고 로그 찍는 함수의 verbosity레벨이 이 값보다 낮을 때만 실제로 출력하는 것

### Channels

로그 출력을 채널로 카테고리 나누는 것도 굉장히 유용하다. 어떤 채널은 애니메이션 관련 로그만, 어떤 채널은 물리 관련 로그만 하는 식으로. 플스3같은 경우는 채널마다 서로 다른 TTY 윈도우에 로그를 찍어서 보여줘서 작업하기 편했다. 윈도우즈에서는 출력창이 하나밖에 없으니 그렇게 할 수 없는데, 이 때도 채널마다 로그 색깔을 다르게 한다거나, 로그 필터 기능을 구현하거나 하는 식으로 해결할 수 있다. 

채널도 구현하기 쉽다. 채널이 32 혹은 64개 이하면 각 채널을 비트마스크로 표현하는 것도 괜찮음

#### Using Redis to Manage TTY Channels

너티독에서는 웹 기반의 커넥터를 사용. redis에 로그 저장하고 웹 브라우저에서 그 로그 볼 수 있는 방식

### Mirroring Output to a File

디버그 아웃풋은 레벨, 채널 구분없이 모든 데이터를 파일에 저장하면 좋다. 이러면 예상치 못한 문제 상황이 발생했을 때 로그 보고 파악하기가 쉬움.

모든 로그가 유실되지 않으려면 로그가 발생할 때마다 그때 그때 파일에 적어줘야 하는데(프로그램이 crash되면 저장 안 해둔 로그는 날아가므로) 문제는 파일에 내용을 적는 연산이 상당히 비싼 연산이라는 것이다. 

그래서 (a) 한 번에 엄청 많은 로그를 찍고 있는 상황이 아니고 (b) 지금 당장 로그 저장하는게 아주 중요한 상황 중 하나일 때만 로그를 저장하는게 좋다. 엔진 설정에서 로그 파일에 저장할지 여부를 켜고 끌 수 있게 해두는 것도 좋음

### Crash Reports

몇몇 게임 엔진은 게임이 죽을 때 크래시 정보에 관한 특별한 출력 혹은 로그 파일을 제공해준다. 대부분의 운영 체제에서 top-level 예외 처리기를 둘 수 있고, 이 예외 처리기는 거의 대부분의 크래시 상황을 잡아낼 수 있다. 이 예외 처리기 내에서 유용한 정보들을 출력해주면 된다(혹은 크래시났다고 이메일을 보내는 것 등도 가능). 

크래시 상황에서 로그 찍으면 좋은 유용한 정보들은 다음과 같다

- 현재 게임 레벨(씬)
- 플레이어 캐릭터의 월드 좌표
- 플레이어의 애니메이션, 액션 상태
- 실행중이던 게임 플레이 스크립트
- 스택 트레이스
- 엔진의 모든 메모리 할당자의 상태
- 크래시가 일어난 순간의 스크린샷

## Debug Drawing Facilities

### Debug Drawing API

## In-Game Menus

## In-Game Conosle

## Debug Cameras and Pausing the Game

## Cheats

## Screenshots and Movie Capture

## In-Game Profiling

### Hierarchical Profiling

### Exporting to Excel

## In-Game Memory Stats and Leak Detection

